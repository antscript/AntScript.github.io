<!DOCTYPE html>
<html class="no-js" lang="zh-CN">

<head profile="http://gmpg.org/xfn/11">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="shortcut icon" href="https://antscript.com/favicon.ico" type="image/x-icon">
    <title>iOS中多语言本地化流程的优化 | 只想安静的做个码农</title>
    <script>
    document.documentElement.className = document.documentElement.className.replace("no-js", "js");
    </script>
    <link href="https://antscript.com/index.xml" rel="alternate" type="application/rss+xml" title="AntScript" />
    <link href="https://antscript.com/index.xml" rel="feed" type="application/rss+xml" title="AntScript &raquo; Feed " />
    <link rel='stylesheet' id='lingonberry_style-css' href='https://cdn.antscript.com/@/antscript.com/static/v1/css/style.min.css?ver=4.0.10' type='text/css' media='all' />
    <script type='text/javascript' src='https://cdn.antscript.com/@/antscript.com/static/v1/js/jquery.min.js?ver=1.10.2'></script>
    
    <style type="text/css">
    body a {
        color: #353535;
    }

    body a:hover {
        color: #353535;
    }

    .header {
        background: #353535;
    }

    .post-bubbles a:hover {
        background-color: #353535;
    }

    .mejs-horizontal-volume-current {
        background-color: #353535;
    }

    .post-nav a:hover {
        background-color: #353535;
    }

    .comment-meta-content cite a:hover {
        color: #353535;
    }

    .comment-meta-content p a:hover {
        color: #353535;
    }

    .comment-actions a:hover {
        background-color: #353535;
    }

    .widget-content .textwidget a:hover {
        color: #353535;
    }

    .widget_archive li a:hover {
        color: #353535;
    }

    .widget_categories li a:hover {
        color: #353535;
    }

    .widget_meta li a:hover {
        color: #353535;
    }

    .widget_nav_menu li a:hover {
        color: #353535;
    }

    .widget_rss .widget-content ul a.rsswidget:hover {
        color: #353535;
    }

    #wp-calendar thead {
        color: #353535;
    }

    .widget_tag_cloud a:hover {
        background: #353535;
    }

    .search-button:hover .genericon {
        color: #353535;
    }

    .flexslider:hover .flex-next:active {
        color: #353535;
    }

    .flexslider:hover .flex-prev:active {
        color: #353535;
    }

    .post-title a:hover {
        color: #353535;
    }

    .post-content a {
        color: #353535;
    }

    .post-content a:hover {
        color: #353535;
    }

    .post-content a:hover {
        border-bottom-color: #353535;
    }

    .post-content fieldset legend {
        background: #353535;
    }

    .post-content input[type="submit"]:hover {
        background: #353535;
    }

    .post-content input[type="button"]:hover {
        background: #353535;
    }

    .post-content input[type="reset"]:hover {
        background: #353535;
    }

    .comment-header h4 a:hover {
        color: #353535;
    }

    .form-submit #submit:hover {
        background-color: #353535;
    }

    @media screen and (min-width: 900px) {
      #app
      {
          z-index: 8000;
          position: fixed;
          text-indent: -99999px;
          width: 100px;
          display: block;
          background: url(https://cdn.antscript.com/@/antscript.com/static/v1/blog/img/app.png) no-repeat 0px 0px;
          height: 100px;
          top: 0px;
          cursor: pointer;
          right: 0px;
      }
    }
    </style>
    
</head>


<body class="single single-post postid-294 single-format-standard has-featured-image">
    
<div class="navigation">
    <div class="navigation-inner section-inner">
        <ul class="blog-menu">
            <li id="menu-item-00" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children has-children menu-item-194"><a>Projects</a>
                <ul class="sub-menu">
                    
                    <li id="menu-item-project-16" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://layautoapp.com" target="_blank">LayAuto</a></li>
                    
                    <li id="menu-item-project-24" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://ticktock.today" target="_blank">Tick Tock Today</a></li>
                    
                    <li id="menu-item-project-27" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://itunes.apple.com/app/devcost-cost-tool-for-developer/id1209838272" target="_blank">DevCost</a></li>
                    
                    <li id="menu-item-project-29" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://aapp.space/idsafer/" target="_blank">IDSafer</a></li>
                    
                    <li id="menu-item-project-55" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="" target="_blank">Projects</a></li>
                    
                </ul>
            </li>
            <li id="menu-item-11" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children has-children menu-item-268"><a>Open Source</a>
                <ul class="sub-menu">
                    
                    <li id="menu-item-opensource-23" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://github.com/antscript/ASLauncherMac" target="_blank">ASLauncherMac</a></li>
                    
                    <li id="menu-item-opensource-32" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://github.com/antscript/ASHUD" target="_blank">ASHUD</a></li>
                    
                    <li id="menu-item-opensource-37" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://github.com/antscript/DockerWeb" target="_blank">DockerWeb</a></li>
                    
                    <li id="menu-item-opensource-53" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="" target="_blank">Open sources</a></li>
                    
                </ul>
            </li>
            <li id="menu-item-22" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-268"><a href="mailto:antscript@gmail.com" target="_blank">antscript@gmail.com</a></li>
        </ul>
        
        <div class="clear"></div>
    </div>
    
</div>

<div class="header section">
    <div class="header-inner section-inner">
        <a href="https://antscript.com/" title="AntScript &mdash; 只想安静的做个码农" rel="home" class="logo">
            <img src="https://cdn.antscript.com/@/antscript.com/static/v1/img/logo.jpg" alt="AntScript">
        </a>
        <h1 class="blog-title">
                    <a href="https://antscript.com/" title="AntScript &mdash; 只想安静的做个码农" rel="home">AntScript</a>
                </h1>
        <div class="nav-toggle">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="clear"></div>
        </div>
        <div class="clear"></div>
    </div>
    
</div>

    <div class="content section-inner">
        <div class="posts">
            <div id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-develop">
                <div class="post-bubbles">
                    <a href="https://antscript.com/post/2017-08-08-ios-localized-optimization/" class="format-bubble" title="iOS中多语言本地化流程的优化"></a>
                </div>
                <div class="content-inner">
                    <div class="post-header">
                        
                        <div class="featured-media">
                            <img width="766" height="284" src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-08-08/localized_title.jpg" class="attachment-post-image wp-post-image" alt="iOS中多语言本地化流程的优化" />
                        </div>
                        
                        
                        <h2 class="post-title">iOS中多语言本地化流程的优化</h2>
                    </div>
                    
                    <div class="post-content">
                        <p>本文从提升效率和减少错误两方面对传统的多语言本地化方式进行了优化，虽然标题是iOS，但其实macOS也通用。</p>

<ul>
<li><u><a href="https://antscript.com/post/2017-08-08-iOS-Localized-Optimization/#chapter1">传统的方法</a></u></li>
<li><u><a href="https://antscript.com/post/2017-08-08-iOS-Localized-Optimization/#chapter2">提升点效率</a></u></li>
<li><u><a href="https://antscript.com/post/2017-08-08-iOS-Localized-Optimization/#chapter3">减少些错误</a></u></li>
<li><u><a href="https://antscript.com/post/2017-08-08-iOS-Localized-Optimization/#chapter4">自动化万岁</a></u></li>
</ul>

<p>[2017.09.10]之前脚本有错误，经Lu_z_x指出现在已更正.</p>

<p></p>

<p><br/>
<br/>
<br/></p>

<p><a name="chapter1"></a></p>

<h4 id="传统的方法"><strong>传统的方法</strong></h4>

<hr />

<p>在 <strong>Localizable.strings</strong> 中写入多种语言的版本，然后使用 <strong>NSLocalizedString</strong> 进行本地化:</p>

<pre><code># en.lproj/Localizable.strings
&quot;login&quot; = &quot;Login&quot;;
&quot;logout&quot; = &quot;Logout&quot;;

# zh-Hans.lproj/Localizable.strings
&quot;login&quot; = &quot;登录&quot;;
&quot;logout&quot; = &quot;退出&quot;;

# usage
loginButton.title = NSLocalizedString(&quot;login&quot;, comment: &quot;login&quot;)
logoutButton.title = NSLocalizedString(&quot;logout&quot;, comment: &quot;logout&quot;)
</code></pre>

<p><br/>
这有什么问题呢？
</br>
繁琐！每次都要写 <strong>NSLocalizedString(&ldquo;xxx&rdquo;, comment: &ldquo;xxx&rdquo;)</strong> ，虽然有代码补全，但依然很费时。
<br/>
<br/>
<br/></p>

<p><a name="chapter2"></a></p>

<h4 id="提升点效率"><strong>提升点效率</strong></h4>

<hr />

<p>直接上代码：</p>

<pre><code>
extension String {
    var localized: String {
        return NSLocalizedString(self, comment: self)
    }
}
</code></pre>

<p>于是现在的使用方式就变成了：</p>

<pre><code>
loginButton.title = &quot;login&quot;.localized
logoutButton.title = &quot;logout&quot;.localized
</code></pre>

<p><br/>
这样代码简洁多了，也保留了代码的自解释。
</br>
但，依然还有问题，如果我不小心写成了：</p>

<pre><code>
loginButton.title = &quot;login&quot;.localized
logoutButton.title = &quot;loguot&quot;.localized
</code></pre>

<p></br>
编译不会报错，但logoutButton的title却出不来（注意 <strong>&ldquo;loguot&rdquo;.localized</strong>），写错一个字母，抓bug抓好长时间的经历相信很多人都遇到过吧。
</br>
</br>
这里涉及到编码中的一个小技巧：<strong>不要徒手写同一个需要多次使用的字符串，尽量定义成常量进行调用。</strong>
<br/>
<br/>
<br/></p>

<p><a name="chapter3"></a></p>

<h4 id="减少些错误"><strong>减少些错误</strong></h4>

<hr />

<p>还是直接上代码：</p>

<pre><code>
extension String {
    static var localized_login: String { return &quot;login&quot;.localized }
    static var localized_logout: String { return &quot;logout&quot;.localized }
}

</code></pre>

<p>现在用起来就更爽了：</p>

<pre><code>
loginButton.title = .localized_login
logoutButton.title = .localized_logout
</code></pre>

<p>得益于Xcode代码提示补全的功能，我只需输入&rdquo;.&rdquo; &ldquo;login&rdquo; 回车，基本就就可以完成输入：
<img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-08-08/localized_login.jpg" alt="localized_login.png" />
</br>
</br>
乍一看，已经将写字符串时出错的概率降到最低了，但这样又要多写一堆代码，岂不是把之前好不容易提升起来的效率又降低了，再加上万一，我们在写 <strong>localized_logout</strong> 时还是写成了 <strong>&ldquo;loguot&rdquo;.localized</strong> ，这不是&rdquo;辛辛苦苦大半年，一朝回到解放前&rdquo;的节奏？
<br/>
<br/>
<br/></p>

<p><a name="chapter4"></a></p>

<h4 id="自动化万岁"><strong>自动化万岁</strong></h4>

<hr />

<p>思路：使用脚本读取 <strong>Localizable.strings</strong> ，然后输出成我们需要的常量格式。</p>

<p>Build Phases中新建一个 <strong>Run Script</strong>，填入以下脚本：</p>

<pre><code># Localizable.strings文件路径
localizableFile=&quot;${SRCROOT}/${PROJECT_NAME}/Support/en.lproj/Localizable.strings&quot;

# 生成的swift文件路径（根据个人习惯修改）
localizedFile=&quot;${SRCROOT}/${PROJECT_NAME}/Source/Utils/LocalizedUtils.swift&quot;

touch $localizedFile

# 将localizable.strings中的文本转为swift格式的常量，存入一个临时文件
sed &quot;s/\&quot; = \&quot;.*$/;/g&quot; ${localizableFile} | sed &quot;s/.*/&amp; &amp;/&quot; | sed &quot;s/^\&quot;/  static var localized_/g&quot; | sed &quot;s/; \&quot;/: String { return \&quot;/g&quot; | sed &quot;s/;/\&quot;.localized }/g&quot; &gt; &quot;${localizedFile}.tmp&quot;

# 先将localized作为计算属性输出到目标文件
echo -e &quot;import Foundation\n\nextension String {\n  var localized: String { return NSLocalizedString(self, comment: self) }&quot; &gt; &quot;${localizedFile}&quot;

# 再将临时文件中的常量增量输出到目标文件
cat &quot;${localizedFile}.tmp&quot; &gt;&gt; &quot;${localizedFile}&quot;

# 最后增量输出一个&quot;}&quot;到目标文件，完成输出
echo -e &quot;\n}&quot; &gt;&gt; &quot;${localizedFile}&quot;

# 删除临时文件
rm &quot;${localizedFile}.tmp&quot;
</code></pre>

<p>以上脚本的作用就是将localizable.strings中的内容转换成swift的常量形式，并作为String的extension存储起来，具体步骤看注释。
</br>
</br>
其中有几点需要注意：
</br></p>

<ul>
<li>第一次运行记得将<strong>LocalizableUtils.swift</strong>加入到Xcode项目中</li>
<li>sed的用法中，<strong>^&hellip;</strong> 表示以&hellip;开头，<strong>&hellip;$</strong> 表示以&hellip;结尾 [<a href="https://stackoverflow.com/questions/11659970/finding-and-replacing-lines-that-begin-with-a-pattern" target="_blank">参考链接</a>]。</li>
<li><strong>&gt;</strong> 表示覆盖输出到文件，<strong>&gt;&gt;</strong> 表示增量输出到文件。</li>
<li><strong>echo -e</strong> 表示将\n作为换行符输出（其他转义字符同效）。</li>
<li>将 <strong>Run Script</strong> 放在 <strong>Compile Sources</strong> 的上面，这样可以在编译代码前执行，如果出现错误也很容易定位（例如Localizable.strings中行末忘记写分号）。
</br>
</br>
<img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-08-08/xcode_run_script.jpg" alt="run_script" />
</br>
</br></li>
</ul>

<p>脚本效果：</p>

<p>本地化文件：</p>

<pre><code>
# en.lproj/Localizable.strings

&quot;login&quot; = &quot;Login&quot;;
&quot;logout&quot; = &quot;Logout&quot;;
</code></pre>

<p>输出文件：</p>

<pre><code>
# LocalizedUtils.swift

import Foundation

extension String {
  var localized: String { return NSLocalizedString(self, comment: self) }

  static var localized_login: String { return &quot;login&quot;.localized }
  static var localized_logout: String { return &quot;logout&quot;.localized }
}
</code></pre>

<p>至此，我们只要在写好Localizable.strings或有修改时 <strong>⌘+B</strong> build一下，就能愉快的使用了。</p>

<p>当然，如果你有其他更好的方式，欢迎邮件交流 antscript#gmail.com ：）。</p>
                    </div>
                    
                    <div class="post-meta">
                        <span class="post-date">2017-08-08 19:28:33 &#43;0800 CST</span>
                    </div>
                    
                    
                </div>
                
                <div class="clear"></div>
                <div class="post-nav">
                    
                    <a class="post-nav-older" title="Next post: ErgoDox小坑 - Command键失灵" href="https://antscript.com/post/2017-11-21-ergodox/">&laquo; ErgoDox小坑 - Command键失灵</a>
                    
                    
                    <a class="post-nav-newer" title="Previous post: [自动化之路] - 单人iOS项目的自动化实践" href="https://antscript.com/post/2017-07-07-ios-devops-1/">[自动化之路] - 单人iOS项目的自动化实践 &raquo;</a>
                    
                    <div class="clear"></div>
                </div>
                
            </div>
            
        </div>
        
    </div>
    
    <div class="credits section">
    <div class="credits-inner section-inner">
        <p class="credits-left">
            <span>Copyright</span> &copy; 2014-2017 <a href="https://antscript.com/" title="AntScript"> AntScript.com</a>
        </p>
        <p class="credits-right">
            <span>Powered by <a href="http://www.hugo.org" target="_blank">Hugo</a> | Theme by <a href="http://www.andersnoren.se"  target="_blank">Anders Noren</a> &mdash; </span><a title="To the top" class="tothetop">Up &uarr;</a>
        </p>
        <div class="clear"></div>
    </div>
    
</div>
<script type='text/javascript' src='https://cdn.antscript.com/@/antscript.com/static/v1/js/global.js?ver=4.0.10'></script>
<div style="display:none"><script src="https://s4.cnzz.com/stat.php?id=1258630582&web_id=1258630582" language="JavaScript"></script></div>





</body>

</html>
