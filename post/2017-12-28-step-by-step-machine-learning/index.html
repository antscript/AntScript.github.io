<!DOCTYPE html>
<html class="no-js" lang="zh-CN">

<head profile="http://gmpg.org/xfn/11">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="shortcut icon" href="https://antscript.com/favicon.ico" type="image/x-icon">
    <title>Step by Step，一个周末入门机器学习 | 只想安静的做个码农</title>
    <script>
    document.documentElement.className = document.documentElement.className.replace("no-js", "js");
    </script>
    <link href="https://antscript.com/index.xml" rel="alternate" type="application/rss+xml" title="AntScript" />
    <link href="https://antscript.com/index.xml" rel="feed" type="application/rss+xml" title="AntScript &raquo; Feed " />
    <link rel='stylesheet' id='lingonberry_style-css' href='https://cdn.antscript.com/@/antscript.com/static/v1/css/style.min.css?ver=4.0.10' type='text/css' media='all' />
    <script type='text/javascript' src='https://cdn.antscript.com/@/antscript.com/static/v1/js/jquery.min.js?ver=1.10.2'></script>
    
    <style type="text/css">
    body a {
        color: #353535;
    }

    body a:hover {
        color: #353535;
    }

    .header {
        background: #353535;
    }

    .post-bubbles a:hover {
        background-color: #353535;
    }

    .mejs-horizontal-volume-current {
        background-color: #353535;
    }

    .post-nav a:hover {
        background-color: #353535;
    }

    .comment-meta-content cite a:hover {
        color: #353535;
    }

    .comment-meta-content p a:hover {
        color: #353535;
    }

    .comment-actions a:hover {
        background-color: #353535;
    }

    .widget-content .textwidget a:hover {
        color: #353535;
    }

    .widget_archive li a:hover {
        color: #353535;
    }

    .widget_categories li a:hover {
        color: #353535;
    }

    .widget_meta li a:hover {
        color: #353535;
    }

    .widget_nav_menu li a:hover {
        color: #353535;
    }

    .widget_rss .widget-content ul a.rsswidget:hover {
        color: #353535;
    }

    #wp-calendar thead {
        color: #353535;
    }

    .widget_tag_cloud a:hover {
        background: #353535;
    }

    .search-button:hover .genericon {
        color: #353535;
    }

    .flexslider:hover .flex-next:active {
        color: #353535;
    }

    .flexslider:hover .flex-prev:active {
        color: #353535;
    }

    .post-title a:hover {
        color: #353535;
    }

    .post-content a {
        color: #353535;
    }

    .post-content a:hover {
        color: #353535;
    }

    .post-content a:hover {
        border-bottom-color: #353535;
    }

    .post-content fieldset legend {
        background: #353535;
    }

    .post-content input[type="submit"]:hover {
        background: #353535;
    }

    .post-content input[type="button"]:hover {
        background: #353535;
    }

    .post-content input[type="reset"]:hover {
        background: #353535;
    }

    .comment-header h4 a:hover {
        color: #353535;
    }

    .form-submit #submit:hover {
        background-color: #353535;
    }

    @media screen and (min-width: 900px) {
      #app
      {
          z-index: 8000;
          position: fixed;
          text-indent: -99999px;
          width: 100px;
          display: block;
          background: url(https://cdn.antscript.com/@/antscript.com/static/v1/blog/img/app.png) no-repeat 0px 0px;
          height: 100px;
          top: 0px;
          cursor: pointer;
          right: 0px;
      }
    }
    </style>
    
</head>


<body class="single single-post postid-294 single-format-standard has-featured-image">
    
<div class="navigation">
    <div class="navigation-inner section-inner">
        <ul class="blog-menu">
            <li id="menu-item-00" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children has-children menu-item-194"><a>Projects</a>
                <ul class="sub-menu">
                    
                    <li id="menu-item-project-13" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://layautoapp.com" target="_blank">LayAuto</a></li>
                    
                    <li id="menu-item-project-21" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://ticktock.today" target="_blank">Tick Tock Today</a></li>
                    
                    <li id="menu-item-project-24" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://itunes.apple.com/app/devcost-cost-tool-for-developer/id1209838272" target="_blank">DevCost</a></li>
                    
                    <li id="menu-item-project-26" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://aapp.space/idsafer/" target="_blank">IDSafer</a></li>
                    
                    <li id="menu-item-project-52" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="" target="_blank">Projects</a></li>
                    
                </ul>
            </li>
            <li id="menu-item-11" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children has-children menu-item-268"><a>Open Source</a>
                <ul class="sub-menu">
                    
                    <li id="menu-item-opensource-20" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://github.com/antscript/ASLauncherMac" target="_blank">ASLauncherMac</a></li>
                    
                    <li id="menu-item-opensource-29" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://github.com/antscript/ASHUD" target="_blank">ASHUD</a></li>
                    
                    <li id="menu-item-opensource-34" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="https://github.com/antscript/DockerWeb" target="_blank">DockerWeb</a></li>
                    
                    <li id="menu-item-opensource-50" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-195"><a href="" target="_blank">Open sources</a></li>
                    
                </ul>
            </li>
            <li id="menu-item-22" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-268"><a href="mailto:antscript@gmail.com" target="_blank">antscript@gmail.com</a></li>
        </ul>
        
        <div class="clear"></div>
    </div>
    
</div>

<div class="header section">
    <div class="header-inner section-inner">
        <a href="https://antscript.com/" title="AntScript &mdash; 只想安静的做个码农" rel="home" class="logo">
            <img src="https://cdn.antscript.com/@/antscript.com/static/v1/img/logo.jpg" alt="AntScript">
        </a>
        <h1 class="blog-title">
                    <a href="https://antscript.com/" title="AntScript &mdash; 只想安静的做个码农" rel="home">AntScript</a>
                </h1>
        <div class="nav-toggle">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="clear"></div>
        </div>
        <div class="clear"></div>
    </div>
    
</div>

    <div class="content section-inner">
        <div class="posts">
            <div id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-develop">
                <div class="post-bubbles">
                    <a href="https://antscript.com/post/2017-12-28-step-by-step-machine-learning/" class="format-bubble" title="Step by Step，一个周末入门机器学习"></a>
                </div>
                <div class="content-inner">
                    <div class="post-header">
                        
                        <div class="featured-media">
                            <img width="766" height="284" src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-12-21/machine-learning.jpg" class="attachment-post-image wp-post-image" alt="Step by Step，一个周末入门机器学习" />
                        </div>
                        
                        
                        <h2 class="post-title">Step by Step，一个周末入门机器学习</h2>
                    </div>
                    
                    <div class="post-content">
                        <h1 id="导读">导读</h1>

<hr />

<p>​   几个月前开始入门机器学习时，面对一堆英文视频和数学基础，咬紧牙关摸爬滚打，终于可以在SideProject上试着使用机器学习了。</p>

<p>​   回首前路，发现自己摸索的是一条坑多路绕的林间小道，而当我到达此处，发现并不需要如此艰苦耗时，作为前车之鉴，将这几个月的心得分享给刚开始入门或正打算入门，以及从入门到放弃了的广大程序员。</p>

<p>​   本系列文章面向对机器学习感兴趣的任何人，无需数学基础，力求从无任何基础的角度与实践方式出发，让大家能够在几天的时间内了解最简的机器学习使用流程，以实验的性质运用到工作或个人项目中，解决一些简单但繁琐的实际问题，从而为更进一步的深入学习打下基础。</p>

<h1 id="目录">目录</h1>

<hr />

<ul>
<li>基础理论

<ul>
<li>关于机器学习</li>
<li>什么是机器学习</li>
<li>机器学习流程</li>
<li>机器学习分类</li>
</ul></li>
<li>Hello World

<ul>
<li>环境搭建</li>
<li>学习目标</li>
<li>数据准备</li>
<li>训练模型</li>
<li>保存模型</li>
<li>要点自查</li>
</ul></li>
<li>First App

<ul>
<li>学习目标</li>
<li>模型转换</li>
<li>模型导入</li>
<li>开始编码</li>
<li>运行结果</li>
<li>​</li>
</ul></li>
<li>总结

<ul>
<li>要点回顾</li>
<li>错过了什么</li>
<li>那接下来呢</li>
</ul></li>
</ul>

<p></p>

<p><br/>
<br/></p>

<hr />

<p>暗色的PDF版本可从这里下载:</p>

<p><u><a href="https://cdn.antscript.com/antscript.com/upload/2017-12-28/step_by_step_machine_learning_v1.0.0_by_AntScript.pdf" target="_blank">step_by_step_machine_learning_v1.0.0_by_AntScript.pdf</a></u> (1.7MB)</p>

<hr />

<p><br/>
<br/></p>

<h1 id="基础理论">基础理论</h1>

<hr />

<h2 id="关于机器学习">关于机器学习</h2>

<p>回看历史，当科技发展到一定程度的时候，很可能会对社会的发展变革产生显著的影响。</p>

<ul>
<li>第一次科技革命，随着蒸汽机、采煤、钢铁等技术的发展，人类大规模的用机器取代了人力、兽力的生产；</li>
<li>第二次科技革命，随着电力得到了大规模的应用，极大地推动了生产力的发展；</li>
<li>第三次科技革命，随着信息技术的发展，人类进入了数字化的信息时代。</li>
</ul>

<p>当下，学术研究和硬件性能所达到的高度，很可能使得机器学习成为第四次科技革命的开始。</p>

<p>曾经技术娴熟的手工艺人，在自动化设备的质量和效率面前只能兴叹；而现在处于世界围棋巅峰的人类，AlphaGo只要自学3天就能将其打败。</p>

<p>所以说机器学习的本质其实和蒸汽机，电力一样，它是一种技术，一种可以扩展人类自身限制的技术。</p>

<p>例如开车，你并不需要了解汽车的所有原理，只要学会了驾驶技术，有了驾照，就能使用汽车来打破自身速度和体能的限制，在短时间内到达以前步行所不能及的远方；机器学习也是一样的，你并不需要学会所有相关的理论知识，只要掌握了一定的概念和流程，就能用它来打破自己大脑的限制，产生出以前自身智力无法企及的解决问题的方法。</p>

<p>当然，会修车的驾驶员能在汽车出现问题的时候找到问题并解决，这些会汽车修理的驾驶员后来就成为了汽车方面的专家；想要成为机器学习的专家，不仅要学会如何使用，还要深刻理解其运作的原理，并且能够调整和改进它。</p>

<p>本文致力于了解如何使用机器学习而不考虑其背后的原理，在不使用任何图像识别技术的前提下，通过一个手写数字识别App的开发，来感受机器学习给我们带来的更多可能。</p>

<h2 id="什么是机器学习">什么是机器学习</h2>

<p>抽象的说法，机器学习是通多对旧数据的分析，自动总结出能预测在新条件下结果的方法。</p>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-12-21/human_learning.png" alt="human_learning" /></p>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-12-21/computer_learning.png" alt="computer_learning" /></p>

<h4 id="思考"><strong>思考</strong></h4>

<p>机器学习和人类学习的区别和各自的优劣势。</p>

<h2 id="机器学习流程">机器学习流程</h2>

<p>先来想一下我们人类的学习过程是怎样的：</p>

<p>一个自然风光的摄影师，常年在大自然中拍摄取景，经过多年的观察与积累，成为了一个预测天气的好手。</p>

<p>而计算机是怎样成为天气预测专家的呢？输入了大量的历史数据，经过分析对比，找到了规律，天气预测的结果八九不离十，准确率比摄影师还要高。</p>

<h4 id="思考-1"><strong>思考</strong></h4>

<p>他们的相同点是都需要经验累积，而差异就在于人类需要数年甚至数十年才能成为某个领域的专家，而机器只要有足够的数据，只要很短的时候就能达到或超越人类。</p>

<h2 id="机器学习分类">机器学习分类</h2>

<p>目前我们只要关心两种机器学习的类型：<strong>预测</strong> 和 <strong>分类</strong>。</p>

<h4 id="分类"><strong>分类</strong></h4>

<p>分类的结果是离散的，或者说是枚举类型，例如一张图片，识别其中是 1猫 2狗 3两者都不是，结果里有3个枚举，所以属于分类</p>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-21-21/classfication.png" alt="" /></p>

<h4 id="预测"><strong>预测</strong></h4>

<p>相对于分类，预测（或者叫线性回归）的结果是连续的，在一个区间范围内的某一点，例如给定日期和航班，预测机票的价格，它的结果是一个在0到正无穷（从理论上来说）的开区间上一点。</p>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-21-21/prediction.png" alt="prediction" /></p>

<h4 id="总结"><strong>总结</strong></h4>

<p>回顾一下机器学习的过程</p>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-12-21/computer_learning.png" alt="computer_learning" /></p>

<ul>
<li>首先，需要收集足够的数据；</li>
<li>然后，计算机需要用某种方法对数据进行分析学习；</li>
<li>最后，机器具备了预测或分类的能力。</li>
</ul>

<p><br/></p>

<p>以下问题属于分类还是预测？</p>

<ul>
<li>通过用户的历史浏览及购买记录，判断他是否会购买某个商品。</li>
<li>为用户上传的图片自动打上标签。</li>
<li>预报明天的PM2.5指数</li>
</ul>

<p><br/></p>

<p>下一章将开始机器学习的实践，需要具备初级的编程能力。</p>

<p><br/>
<br/></p>

<h1 id="hello-world">Hello World</h1>

<hr />

<h2 id="环境搭建">环境搭建</h2>

<h4 id="anaconda"><strong>Anaconda</strong></h4>

<p>Anaconda是一个非常方便的数据分析Python集成工具/环境，包含了大部分数据分析所用的工具/包，支持Mac，Windows，Linux。我们只需安装这一个软件即可。</p>

<p>如果你已经熟悉Python的开发可略过直接看下一节。</p>

<p>下载Anaconda（不清楚版本区别的话建议安装Python3.6的版本，）
<strong><u><a target="_blank" href="https://www.anaconda.com/download"><a href="https://www.anaconda.com/download">https://www.anaconda.com/download</a></a></u></strong></p>

<p>Mac安装使用默认配置即可，Windows需要手动选中配置环境变量。</p>

<p>完成后运行 Anaconda Navigator。</p>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-21-21/QQ20171120-062348.png" alt="" /></p>

<p>运行 Jupyter notebook，会自动打开一个本地服务器的网页，进入AnacondaProjects文件夹。</p>

<p>新建一个Python3的文件：</p>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-21-21/QQ20171120-063927.png" alt="" /></p>

<p>新打开的页面是一个交互式的Python编程环境，可以在其中运行代码并实时输出结果，非常方便。</p>

<p>一切就绪，可以开始编码了，以下操作均为Mac环境，其他环境大同小异，若有差别请自行Google。</p>

<h2 id="学习目标">学习目标</h2>

<p>在本节中，我们首先要训练一个可识别手写数字的模型，然后把模型保存下来。</p>

<p>这是一套最简化的将机器学习使用到实际应用中的流程的第一步，也是将机器学习应用到实践中最重要的一步，能让我们对机器学习中最重要的概念之一：<strong>训练</strong>，有一个基本的认识。</p>

<h2 id="数据准备">数据准备</h2>

<p>可在交互式环境中逐块输入以下代码，Shift + 回车 运行。</p>

<p>上一章中说到机器学习的第一步是收集数据，我们就使用这套已经收集好的数据集。</p>

<h4 id="导入函数库"><strong>导入函数库</strong></h4>

<pre><code class="language-python">import matplotlib.pyplot as plt
from sklearn import datasets, svm
</code></pre>

<ul>
<li><strong>matplotlib.pyplot</strong> : 用来显示图像</li>
<li><strong>sklearn.datasets</strong> : 包含了各种类型大量的机器学习数据集</li>
<li><strong>sklearn.svm</strong> : SVM(Support Vector Machine)支持向量机，机器学习中的一种算法</li>
<li><strong>sklearn.metrics</strong> : 用来评估模型的准确率</li>
</ul>

<h4 id="加载数据"><strong>加载数据</strong></h4>

<pre><code class="language-python">digits = datasets.load_digits()
</code></pre>

<ul>
<li><strong>load_digits()</strong> : sklearn中包含的一组手写数字的数据集，可看作是机器学习中的Hello World</li>
</ul>

<h4 id="数据信息"><strong>数据信息</strong></h4>

<ul>
<li><strong>images</strong> : 8x8的矩阵二维数组，存储了手写数字的图像数值</li>
<li><strong>data</strong> : 将images中的矩阵摊平成64个元素的一维数组</li>
<li><strong>target</strong> : images中的每个矩阵所代表的数字，0-9</li>
<li><strong>target_names</strong> : target的标签</li>
</ul>

<p>可以通过逐条输出来自己熟悉一下整个数据的结构</p>

<pre><code class="language-python">len(digits.images)
digits.images[5]
digits.data[5]
digits.target[5]
digits.target_names[5]
</code></pre>

<p>接下来我们定义一个函数，可以图形化的显示数据</p>

<pre><code class="language-python">def show_image(image, label):
    plt.figure(1, figsize=(3, 3))
    plt.imshow(image, cmap=plt.cm.gray_r, interpolation='nearest')
    plt.title(label)
    plt.show()
</code></pre>

<p>现在我们可以使用这个函数来更加直观的显示数据，随便显示几个试试</p>

<pre><code>show_image(digits.images[5], digits.target[5])
</code></pre>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-21-21/QQ20171122-063714.png" alt="" /></p>

<h2 id="训练模型">训练模型</h2>

<p>数据已经准备好，我们可以开始训练模型了</p>

<pre><code class="language-python"># 对数据进行分割，使用2/3的数据进行训练，1/3的数据进行测试
# train_test_split是sklearn提供的一个用于分割数据的函数
# X_train : 训练用的图片数据
# y_train : 训练用的已分类的图片类别
# X_train : 测试用的图片数据
# y_train : 测试时用于对比测试结果的已分类图片类别
X = digits.data
y = digits_dataset.target
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)

# 初始化一个SVC（Support Vector Classification）分类器
classifier = svm.SVC(gamma=0.001)

# 使用训练数据进行训练
classifier.fit(X_train, y_train)

# 查看模型在测试数据上的预测准确度
classifier.score(X_test, y_test)
# 0.96327212020033393

# 对比下前20个中的预测结果
predicted = classifier.predict(y_test[:20])
print(predicted)
print(testing_target[:20])

# 20个中有一个错误,准确率95%，还是基本符合上面0.963的准确率
</code></pre>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-21-21/QQ20171124-061801.png" alt="" /></p>

<ul>
<li>训练数据和测试数据不能重合，就好像平时训练我们做了很多真题，而考试的时候出现的都是已经做过的题目，这样就不能很好的反映出我们真实的水平</li>
</ul>

<p>​</p>

<h2 id="保存模型">保存模型</h2>

<p>上面我们所使用的训练数据是一个很小的数据集，很快就把模型训练完了，但在真实的环境中，一般情况下的训练数据是很庞大的，并不能很快训练完成，有的需要几十分钟，几个小时，甚至几天。所以我们需要把训练好的模型保存下来，以备下次使用。</p>

<p>sklearn已经包含了保存模型的模块joblib</p>

<pre><code class="language-python">from sklearn.externals import joblib
</code></pre>

<h4 id="保存"><strong>保存</strong></h4>

<pre><code class="language-python">joblib.dump(classifier, 'digits.pkl')
</code></pre>

<h4 id="读取"><strong>读取</strong></h4>

<pre><code class="language-python">classifier = joblib.load('digits.pkl')
</code></pre>

<h2 id="要点自查">要点自查</h2>

<ul>
<li>如何使用sklearn中的数据集</li>
<li>如何使用数据训练模型</li>
<li>如何保存已训练好的模型</li>
</ul>

<p><br/>
<br/></p>

<h1 id="first-app">First App</h1>

<hr />

<h2 id="学习目标-1">学习目标</h2>

<p>本节会将上一节中导出的模型使用到我们的iOS工程中，开发一个可通过摄像头拍照进行手写数字识别的App。</p>

<p>本节开发的例子是基于iOS的，如果你是其他平台的开发者，可查阅对应的资料，将模型应用于自己熟悉的平台上。</p>

<h2 id="模型转换">模型转换</h2>

<p>从iOS11开始，Apple推出的CoreML库支持了机器学习，能很方便的将训练好的模型集成到Xcode工程中，但前提是需要将训练好的模型转换成Xcodo支持的格式（.mlmodel）。</p>

<h4 id="使用python2"><strong>使用Python2</strong></h4>

<p>模型转换使用的是Apple提供的一个基于Python的工具<a href="https://pypi.python.org/pypi/coremltools">coremltools</a>，但目前仅支持Python2，如果使用的是3的话，还需要安装一个支持2的模块，命令行中直接运行：</p>

<pre><code class="language-shell">python2 -m pip install ipykernel
python2 -m ipykernel install --user
</code></pre>

<h5 id="参考链接-https-stackoverflow-com-questions-30492623-using-both-python-2-x-and-python-3-x-in-ipython-notebook-https-stackoverflow-com-questions-30492623-using-both-python-2-x-and-python-3-x-in-ipython-notebook"><strong>参考链接</strong> <a href="https://stackoverflow.com/questions/30492623/using-both-python-2-x-and-python-3-x-in-ipython-notebook">https://stackoverflow.com/questions/30492623/using-both-python-2-x-and-python-3-x-in-ipython-notebook</a></h5>

<p>安装完成后，新建一个Python2的文件：</p>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-21-21/QQ20171128-064243.png" alt="" /></p>

<p>由于我们上一节使用的是Python3导出的模型，在Python2是不能直接读取的，所以我们需要将上一节的内容在Python2上再做一遍（不要直接复制运行，自己写一遍）：</p>

<pre><code class="language-python">from sklearn import datasets, svm
from sklearn.model_selection import train_test_split

digits = datasets.load_digits()

# 对数据进行分割，使用2/3的数据进行训练，1/3的数据进行测试
# train_test_split是
# X_train : 训练用的图片数据
# y_train : 训练用的已分类的图片类别
# X_train : 测试用的图片数据
# y_train : 测试时用于对比测试结果的已分类图片类别
X = digits.data
y = digits.target
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)

# 初始化一个SVC（Support Vector Classification）支持向量机分类器
classifier = svm.SVC(gamma=0.001)

# 使用训练数据进行训练
classifier.fit(X_train, y_train)

# 查看模型在测试数据上的预测准确度
score = classifier.score(X_test, y_test)
print(score)
# 0.96327212020033393

# 保存模型
joblib.dump(classifier, 'digits.pkl')
</code></pre>

<p>你可能会问，为什么不一开始就使用Python2呢？</p>

<ul>
<li>重写一遍代码进行复习</li>
<li>自查资料进一步了解Python2和3的区别</li>
<li>Python3是未来，也许你看到的时候coremltools已经支持了呢</li>
</ul>

<h4 id="转换"><strong>转换</strong></h4>

<p>先在命令行中安装一下coremltools</p>

<pre><code class="language-shell">pip install -U coremltools
</code></pre>

<p>现在我们可以将保存的模型转换为Xcode支持的格式了：</p>

<pre><code class="language-python">from sklearn.externals import joblib
import coremltools

# 读取训练好的模型
classifier = joblib.load('digits.pkl')

# 生成模型的输入参数名称，总共有64个参数，所以我们生成的参数名称如下
# feature_0, feature_1 ... feature_63
feature_names = [&quot;feature_&quot;+str(i) for i, x in enumerate(X_train[0])]

# 将模型转换为coreml的格式，并保存下来
coreml_model = coremltools.converters.sklearn.convert(classifier, feature_names, &quot;digit&quot;)
coreml_model.save(&quot;digits.mlmodel&quot;)
</code></pre>

<p>现在可以在列表中看到digits.mlmodel这个文件了，点击后会在新的页面打开，由于是特殊的格式无法预览，选择 File -&gt; Download 下载下来</p>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-21-21/QQ20171202-060821.png" alt="" /></p>

<ul>
<li>检查下Digits.mlmodel文件，大概有400Kb</li>
<li>不要在列表中右键保存，这样下载的是一个只有8Kb的文件（我在这个坑上花了不少时间）</li>
<li>也可以在<strong>coreml_model.save</strong>的时候直接使用本地路径存储下来（例如 <strong>/Users/[Your-Name]/Downloads/digits.mlmodel</strong>)</li>
</ul>

<h2 id="模型导入">模型导入</h2>

<p>Xcode中新建一个iOS项目，将上一节保存下来的文件拖入到项目中，Xcode会自动解析并列出模型的接口：</p>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-21-21/QQ20171202-061426@2x.png" alt="" /></p>

<p>我们可以看到模型的输出outputs的是一个Int64类型的64位整型（实际只会输出表示数字识别结果的0-9），展开inputs:</p>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-21-21/QQ20171202-061614@2x.png" alt="" /></p>

<p>输入是 feture0 - feature_63 总共64个Double的参数，你一定会想：一个函数有64个参数，那写参数名都得写很久啊！</p>

<p>是的，所以自己来想想办法如何把参数优化一下，让使用起来更加方便，目前我们先将就使用。</p>

<h2 id="开始编码">开始编码</h2>

<p>我们需要预测的是一张图片，而输入的参数是64个Double，这64个Double是8*8的点阵图每个点的灰度值，所以要先把图片转换成64个Double，思考一下如果是你会如何处理？</p>

<p>以下是我的想法：</p>

<ul>
<li>先通过摄像头拍照</li>
<li>把照片缩小为8*8共64个像素的大小</li>
<li>把照片处理成灰度图</li>
<li>将每个像素的灰度值转化为一个Double</li>
<li>最后就有了64个可供输入的Double</li>
</ul>

<p>直接上代码（代码较少，全部都写在<strong>ViewController.swift</strong>里面了）：</p>

<pre><code class="language-swift">import SwifterSwift // 使用了SwifterSwift来简化颜色的操作

// 从一个UIColor中取出灰度值
// (0.0 - 1.0)
// 0.0 -&gt; 最白 1.0 -&gt; 最黑
extension UIColor {
    func getGray() -&gt; Double {
        let rgb = self.rgbComponents
        // 灰度值的一种算法，red * 0.3 + green * 0.59 + blue * 0.11
        var gray = (
            rgb.red.double * 0.3
            +
            rgb.green.double * 0.59
            +
            rgb.blue.double * 0.11
        ).int
        // 设定与一个阈值，以降低光线或背景的影响
        if gray &gt;= 200 {
            gray = 255
        }

        return (255 - gray.double) / 255
    }
}
// 从UIImage中取出某个像素点的UIColor
extension UIImage {
    func getPixelColor(pos: CGPoint) -&gt; UIColor? {

        guard let pixelData = self.cgImage?.dataProvider?.data else {
            return nil
        }
        let data: UnsafePointer&lt;UInt8&gt; = CFDataGetBytePtr(pixelData)

        let pixelInfo: Int = ((Int(self.size.width) * Int(pos.y)) + Int(pos.x)) * 4

        let r = CGFloat(data[pixelInfo]) / CGFloat(255.0)
        let g = CGFloat(data[pixelInfo+1]) / CGFloat(255.0)
        let b = CGFloat(data[pixelInfo+2]) / CGFloat(255.0)
        let a = CGFloat(data[pixelInfo+3]) / CGFloat(255.0)

        return UIColor(red: r, green: g, blue: b, alpha: a)
    }
}
</code></pre>

<pre><code class="language-swift">// 对模型进行扩展，将参数封装，以方便调用
extension digits {
  // 封装模型的预测方法，使用一个8*8的UIImage作为参数，方便调用
  func prediction(image: UIImage) -&gt; Int64? {
        var data: [Double] = []
        for y in 0..&lt;Int(image.size.height) {
            for x in 0..&lt;Int(image.size.width) {
                guard let c = image.getPixelColor(pos: CGPoint(x: x, y: y)) else {
                    break
                }
                data.append(Double(15 - Int(c.getGray().double/16)))
            }
        }
        return prediction(data: data)
    }
  	// 封装一下模型的预测方法，把64个参数封装在一个数组里，方便调用
    func prediction(data: [Double]) -&gt; Int64? {
        guard data.count == 64 else {
            return nil
        }

       if let result = try? prediction(
            feature_0: data[0],
            feature_1: data[1],
            feature_2: data[2],
            feature_3: data[3],
            feature_4: data[4],
            feature_5: data[5],
            feature_6: data[6],
            feature_7: data[7],
            feature_8: data[8],
            feature_9: data[9],
            feature_10: data[10],
            feature_11: data[11],
            feature_12: data[12],
            feature_13: data[13],
            feature_14: data[14],
            feature_15: data[15],
            feature_16: data[16],
            feature_17: data[17],
            feature_18: data[18],
            feature_19: data[19],
            feature_20: data[20],
            feature_21: data[21],
            feature_22: data[22],
            feature_23: data[23],
            feature_24: data[24],
            feature_25: data[25],
            feature_26: data[26],
            feature_27: data[27],
            feature_28: data[28],
            feature_29: data[29],
            feature_30: data[30],
            feature_31: data[31],
            feature_32: data[32],
            feature_33: data[33],
            feature_34: data[34],
            feature_35: data[35],
            feature_36: data[36],
            feature_37: data[37],
            feature_38: data[38],
            feature_39: data[39],
            feature_40: data[40],
            feature_41: data[41],
            feature_42: data[42],
            feature_43: data[43],
            feature_44: data[44],
            feature_45: data[45],
            feature_46: data[46],
            feature_47: data[47],
            feature_48: data[48],
            feature_49: data[49],
            feature_50: data[50],
            feature_51: data[51],
            feature_52: data[52],
            feature_53: data[53],
            feature_54: data[54],
            feature_55: data[55],
            feature_56: data[56],
            feature_57: data[57],
            feature_58: data[58],
            feature_59: data[59],
            feature_60: data[60],
            feature_61: data[61],
            feature_62: data[62],
            feature_63: data[63]
        ) {
            return result.digit
        }
        return nil
    }
}
</code></pre>

<pre><code class="language-swift">// UI
// 使用一个按钮打开摄像头进行拍照，拍照完成后把图片处理成8*8像素，显示出来，然后用一个Label显示预测结果)
let pickImageButton = UIButton(type: UIButtonType.roundedRect)
let resultLabel = UILabel(text: &quot;no result&quot;)
let imageView = UIImageView()

override func viewDidLoad() {
	super.viewDidLoad()

  	pickImageButton.frame = CGRect(x: 0, y: 0, width: 100, height: 50)
    pickImageButton.setTitle(&quot;Pick Image&quot;, for: .normal)
    view.addSubview(pickImageButton)
    pickImageButton.addTarget(self, action: #selector(startPickImage(sender:)), for: UIControlEvents.touchUpInside)

    resultLabel.frame = CGRect(x: 300, y: 200, width: 100, height: 50)
    view.addSubview(resultLabel)

    imageView.frame = CGRect(x: 50, y: 300, width: 256, height: 256)
    imageView.contentMode = .scaleAspectFill
    view.addSubview(imageView)
}
</code></pre>

<pre><code class="language-Swift">// 实现拍照的代理方法
extension ViewController: UIImagePickerControllerDelegate {
    // pickImageButton Action
    @objc func startPickImage(sender: Any) {
        takePicture()
    }
    // 拍照
    func takePicture() {
        guard UIImagePickerController.isSourceTypeAvailable(.camera) else {
            resultLabel.text = &quot;camera not available&quot;
            return
        }

        let cameraPicker = UIImagePickerController()
        cameraPicker.delegate = self
        cameraPicker.sourceType = .camera
        cameraPicker.allowsEditing = false
        present(cameraPicker, animated: true, completion: nil)
    }
    // 拍照取消代理方法
    func imagePickerControllerDidCancel(_ picker: UIImagePickerController) {
        dismiss(animated: true, completion: nil)
    }
    // 拍照完成代理方法
    func imagePickerController(_ picker: UIImagePickerController, didFinishPickingMediaWithInfo info: [String : Any]) {

        dismiss(animated: true, completion: nil)

        guard let image = info[UIImagePickerControllerOriginalImage] as? UIImage else {
            resultLabel.text = &quot;no image&quot;
            return
        }

        // 将图片缩小为8*8
        UIGraphicsBeginImageContext(CGSize(width: 8, height: 8))
        image.draw(in: CGRect(x: 0, y: 0, width: 8, height: 8))
        let newImage = UIGraphicsGetImageFromCurrentImageContext()
        UIGraphicsEndImageContext()

        imageView.image = newImage

        guard let targetImage = newImage else {
            resultLabel.text = &quot;new image is nil&quot;
            return
        }

        let digitsModel = digits()
        guard let result = digitsModel.prediction(image: targetImage) else {
            resultLabel.text = &quot;predict failed&quot;
            return
        }
        resultLabel.text = &quot;\(result)&quot;

		// 将图像装换为预测数据后显示出来
        for y in 0..&lt;Int(targetImage.size.height) {
            for x in 0..&lt;Int(targetImage.size.width) {
                guard let gray = targetImage.getPixelColor(pos: CGPoint(x: x, y: y))?.getGray() else {
                    break
                }
                let color = UIColor(
                    red: 255 - (gray * 255).int,
                    green: 255 - (gray * 255).int,
                    blue: 255 - (gray * 255).int
                )
                images[y * 8 + x].backgroundColor = color
            }
        }
    }
}
</code></pre>

<h2 id="运行结果">运行结果</h2>

<p>我们可以手写几个数字，然后拍照进行预测。但可能是由于图片处理做得不够好，实际测试下来效果并不理想。所以直接在Jupyter中将测试数据显示在屏幕上，然后使用手机拍照进行测试。</p>

<pre><code class="language-python">show_image(digits.images[1501], digits.target[1501])
show_image(digits.images[1502], digits.target[1502])
show_image(digits.images[1503], digits.target[1503])
</code></pre>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-21-21/QQ20171214-063732.png" alt="" /></p>

<p>使用App进行拍照预测，可以看到虽然还原出来的图像有一定偏差，但结果还是很准确的：</p>

<p><img src="https://cdn.antscript.com/@/antscript.com/upload/images/2017-21-21/IMG_4C0E5619E2F8-1.png" alt="" /></p>

<p><br/>
<br/>
<br/>
<br/></p>

<h1 id="总结-1">总结</h1>

<hr />

<p>通过以上学习和练习，相信你已经有种跃跃欲试，想使用机器学习来做点什么的冲动了。希望大家能够保持对机器学习的兴趣与求知欲，充满自信的继续往后的探索学习。</p>

<h2 id="要点回顾">要点回顾</h2>

<ul>
<li>目前我们所知道的两种机器学习类别：<strong>预测</strong> 和 <strong>分类</strong>，而有时也会把分类说成是预测。例如上面的App，所谓“预测图片上的数字”，实则是将图片上的数字在0-9中进行分类。能准确判断问题的类别，对于后续的步骤非常重要。</li>
<li>Python环境的搭建，以及Python2和Python3的区别。</li>
<li>我们使用了<strong>sklearn(scikit-learn)</strong>这个机器学习库，它是一个封装好，只需少许代码即可进行模型训练的库。</li>
<li>进行训练时所使用的算法是 <strong>SVC（Support Vector Classification）支持向量机分类器</strong>，我们将前2/3的数据用于训练，后1/3的数据进行测试，并输出了测试准确率，以此对模型进行评估。</li>
<li>模型的训练需要时间，有的海量数据或密集计算的训练可能耗费很长时间。训练好的模型可以进行保存，以便下次使用。</li>
<li>一个训练好的模型可以在多个平台上使用， 但根据平台所支持的格式，可能需要对模型进行转换。</li>
</ul>

<h2 id="错过了什么">错过了什么</h2>

<p>作为一个机器学习的老鸟可能会说，“这篇文章就是标题党，机器学习博大精深，这就算入门啦？！” 老鸟说得很对，这篇文章要说入门确实还欠缺不少，不仅跳过了大量原理知识的讲解，还隐去了其中的许多细节：</p>

<ul>
<li>除了sklearn，还有一些其他的常用机器学习库，例如也是使用起来比较简单的<strong>Keras</strong>，Google出品的<strong>TensorFlow</strong>，以及<strong>Theano</strong>，<strong>PyTorch</strong>等。</li>
<li>我们训练模型时所使用的数据是现成的，而在实际应用中，还需要<strong>数据收集</strong>，<strong>数据清洗(去重，去错)</strong>，<strong>数据标准化(normalization)</strong>等数据处理的步骤，才能进行接下来的训练。</li>
<li>除了<strong>SVC</strong>，机器学习中还有很多其他的算法，每种算法各有优缺点及适用范围。</li>
<li><strong>调参</strong>是在实际应用的模型训练中一个不可或缺的步骤，通过对输入参数的调整，观察模型输出的准确率，以此来训练出相对更准确的模型。</li>
</ul>

<h2 id="那接下来呢">那接下来呢</h2>

<ul>
<li>sklearn中还有两个入门使用率很高的数据集：<strong>波士顿房价预测</strong> 和 <strong>鸢尾花分类</strong>，通过查阅资料，完成App开发，通过输入房屋的信息对房价进行预测，以及通过输入鸢尾花的信息对花进行分类。</li>
<li>尝试在工作或个人项目中使用上面所学到的机器学习知识来解决一个简单的问题。</li>
<li>自查资料，理解机器学习中更多的常用概念：<strong>过拟合</strong>、<strong>欠拟合</strong>、<strong>监督学习</strong>、<strong>非监督学习</strong>、<strong>损失函数</strong>、<strong>优化函数</strong>等等。</li>
<li>学习一些常用的机器学习算法。参考资料：<u><a href="https://cloud.tencent.com/developer/article/1006970">主流机器学习算法简介与其优缺点分析</a></u></li>
<li>了解深度学习，以及它与机器学习的关系。</li>
<li>后续可能会有新的相关机器学习在实际项目中应用的文章以及深度学习的入门文章，你可以订阅<a href="https://antscript.com">antscript.com</a>的RSS或者通过<u><a href="https://antscript.us16.list-manage.com/subscribe?u=622153c5c5306e5b88fdda57a&id=87d180bb20" target="_blank"><strong>这个链接</strong></a></u>使用邮件订阅更新。</li>
<li>分享或转发这篇文章。</li>
<li>如发现错误请不吝指正，请联系邮箱antscript@gmail.com。</li>
</ul>
                    </div>
                    
                    <div class="post-meta">
                        <span class="post-date">2017-12-27 07:20:23 &#43;0800 CST</span>
                    </div>
                    
                    
                </div>
                
                <div class="clear"></div>
                <div class="post-nav">
                    
                    <a class="post-nav-older" title="Next post: Swift中图片资源使用流程的优化" href="https://antscript.com/post/2018-01-14-ios-assets-optimization/">&laquo; Swift中图片资源使用流程的优化</a>
                    
                    
                    <a class="post-nav-newer" title="Previous post: ErgoDox小坑 - Command键失灵" href="https://antscript.com/post/2017-11-21-ergodox/">ErgoDox小坑 - Command键失灵 &raquo;</a>
                    
                    <div class="clear"></div>
                </div>
                
            </div>
            
        </div>
        
    </div>
    
    <div class="credits section">
    <div class="credits-inner section-inner">
        <p class="credits-left">
            <span>Copyright</span> &copy; 2014-2017 <a href="https://antscript.com/" title="AntScript"> AntScript.com</a>
        </p>
        <p class="credits-right">
            <span>Powered by <a href="http://www.hugo.org" target="_blank">Hugo</a> | Theme by <a href="http://www.andersnoren.se"  target="_blank">Anders Noren</a> &mdash; </span><a title="To the top" class="tothetop">Up &uarr;</a>
        </p>
        <div class="clear"></div>
    </div>
    
</div>
<script type='text/javascript' src='https://cdn.antscript.com/@/antscript.com/static/v1/js/global.js?ver=4.0.10'></script>
<div style="display:none"><script src="https://s4.cnzz.com/stat.php?id=1258630582&web_id=1258630582" language="JavaScript"></script></div>





</body>

</html>
